<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_app_module">
    <sys_app_module action="INSERT_OR_UPDATE">
        <active>true</active>
        <application display_value="AMPS">8609273e13d5f200d9c75d322244b044</application>
        <assessment/>
        <content_page/>
        <device_type/>
        <filter/>
        <hint>Generate refresh records for locations with an install date older than 4 and 1/2 years</hint>
        <homepage/>
        <image/>
        <link_type>SCRIPT</link_type>
        <map_page/>
        <mobile_title>Populate Refresh Records</mobile_title>
        <mobile_view_name>Mobile</mobile_view_name>
        <name/>
        <order>41</order>
        <override_menu_roles>false</override_menu_roles>
        <query>var gr = new GlideRecord('cmn_location');&#13;
gr.addEncodedQuery('u_pos_install_date!=NULL');&#13;
gr.query();&#13;
while(gr.next()){&#13;
	var ref = gr.getDisplayValue('u_pos_install_date');&#13;
	ref = new GlideDateTime(ref);&#13;
	&#13;
	var today = new GlideDateTime();&#13;
	// Duration in days&#13;
	var dur = GlideDateTime.subtract(ref , today); // returns a GlideDuration object&#13;
	var days = dur.getRoundedDayPart();&#13;
	if(days &gt; 1642 &amp;&amp; days &lt; 1825)&#13;
		{&#13;
		var gr1 = new GlideRecord('x_chfa_amps_pos_refresh');&#13;
		gr1.initialize();&#13;
		ref.addYearsUTC(5);&#13;
                gr1.addEncodedQuery('location='+gr.sys_id);&#13;
                gr1.query();&#13;
                if(!gr1.next()){&#13;
&#13;
		//	gs.info(ref.getDate());&#13;
		gr1.setValue('location',gr.sys_id);&#13;
		gr1.setValue('install_date',ref.getDate());&#13;
		&#13;
		gr1.insert();&#13;
               }&#13;
	}&#13;
}&#13;
gs.info("Refresh Records Created");&#13;
&#13;
&#13;
</query>
        <report/>
        <roles>x_chfa_amps.user</roles>
        <survey/>
        <survey_overwrite>true</survey_overwrite>
        <sys_class_name>sys_app_module</sys_class_name>
        <sys_created_by>sandeep.gunnam</sys_created_by>
        <sys_created_on>2017-03-20 18:11:40</sys_created_on>
        <sys_customer_update>true</sys_customer_update>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>71220e3e13617e00d9c75d322244b006</sys_id>
        <sys_mod_count>16</sys_mod_count>
        <sys_name>Generate Refresh Records</sys_name>
        <sys_overrides/>
        <sys_package display_value="AMPS" source="x_chfa_amps">06092f3613d5f200d9c75d322244b022</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="AMPS">06092f3613d5f200d9c75d322244b022</sys_scope>
        <sys_update_name>sys_app_module_71220e3e13617e00d9c75d322244b006</sys_update_name>
        <sys_updated_by>tim.harris</sys_updated_by>
        <sys_updated_on>2017-03-28 14:45:30</sys_updated_on>
        <timeline_page/>
        <title>Generate Refresh Records</title>
        <uncancelable>false</uncancelable>
        <view_name/>
        <window_name/>
    </sys_app_module>
</record_update>
